<?php

use Drupal\node\NodeTypeInterface;

/**
 * Implements hook_theme().
 */
function wienimal_editor_toolbar_theme($existing, $type, $theme, $path)
{
    return [
        'wienimal_editor_toolbar' => [
            'variables' => [
                'attributes' => [],
                'links' => [],
            ],
        ],
        'wienimal_editor_toolbar_menu' => [
            'variables' => [
                'menu_name' => [],
                'items' => [],
            ],
        ],
    ];
}

/**
 * Implements hook_page_top().
 * @param array $page_top
 */
function wienimal_editor_toolbar_page_top(array &$page_top)
{
    Drupal::service('wienimal_editor_toolbar.menu_builder')->buildPageTop($page_top);
}

/**
 * Implements hook_preprocess().
 */
function wienimal_editor_toolbar_template_preprocess_default_variables_alter(&$variables)
{
    /** @var \Drupal\wienimal_editor_toolbar\Service\EditorToolbar $service */
    $service = Drupal::service('wienimal_editor_toolbar');
    $config = Drupal::config('wienimal_editor_toolbar.settings');

    // Load logo
    if ($config->get('show_logo') && $logo = $service->getLogo()) {
        $variables['logo'] = $logo;
    }

    // Load version variables
    if ($config->get('show_version_info') && $versionInfo = $service->getVersionInfo()) {
        $variables['version'] = $versionInfo['version'];
        $variables['versionDate'] = $versionInfo['date'];
    }

    // Load user variables
    if ($variables['logged_in']) {
        /** @var \Drupal\Core\Session\UserSession $user */
        $user = $variables['user']->getAccount();
        $variables['username'] = $user->getDisplayName();
    }
}

function wienimal_editor_toolbar_locale_translation_projects_alter(&$projects)
{
    $path = drupal_get_path('module', 'wienimal_editor_toolbar') . '/translations/%language.po';
    $projects['wienimal_editor_toolbar']['info']['interface translation server pattern'] = $path;
}
